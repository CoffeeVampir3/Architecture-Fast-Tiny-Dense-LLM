<svg viewBox="0 0 400 600" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
        </marker>
    </defs>

    <!-- Input -->
    <rect x="150" y="20" width="100" height="40" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="200" y="45" text-anchor="middle" font-family="Arial" font-size="14" fill="#333">Input IDs</text>

    <!-- Arrow -->
    <line x1="200" y1="60" x2="200" y2="80" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Embedding -->
    <rect x="150" y="80" width="100" height="40" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="200" y="105" text-anchor="middle" font-family="Arial" font-size="14" fill="#333">Embedding</text>

    <!-- Arrow -->
    <line x1="200" y1="120" x2="200" y2="140" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Decoder Block -->
    <rect x="50" y="140" width="300" height="280" fill="#f5f5f5" stroke="#666" stroke-width="2" stroke-dasharray="5,5" rx="10"/>
    <text x="200" y="160" text-anchor="middle" font-family="Arial" font-size="12" font-weight="bold" fill="#666">Decoder Layer (×24)</text>

    <!-- LayerNorm 1 -->
    <rect x="130" y="175" width="140" height="30" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2" rx="5"/>
    <text x="200" y="195" text-anchor="middle" font-family="Arial" font-size="12" fill="#333">ZeroCenteredRMSNorm</text>

    <!-- Arrow -->
    <line x1="200" y1="205" x2="200" y2="220" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Multi-Head Attention -->
    <rect x="130" y="220" width="140" height="30" fill="#e1f5e1" stroke="#4caf50" stroke-width="2" rx="5"/>
    <text x="200" y="240" text-anchor="middle" font-family="Arial" font-size="12" fill="#333">Multi-Head Attention</text>

    <!-- Residual connection 1 -->
    <path d="M 130 190 Q 80 235 130 235" fill="none" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="60" y="235" font-family="Arial" font-size="11" fill="#ff9800">+</text>

    <!-- Arrow -->
    <line x1="200" y1="250" x2="200" y2="270" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- LayerNorm 2 -->
    <rect x="130" y="270" width="140" height="30" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2" rx="5"/>
    <text x="200" y="290" text-anchor="middle" font-family="Arial" font-size="12" fill="#333">ZeroCenteredRMSNorm</text>

    <!-- Arrow -->
    <line x1="200" y1="300" x2="200" y2="315" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- MLP -->
    <rect x="130" y="315" width="140" height="30" fill="#fff9c4" stroke="#fbc02d" stroke-width="2" rx="5"/>
    <text x="200" y="335" text-anchor="middle" font-family="Arial" font-size="12" fill="#333">MLP (LlamaMLP)</text>

    <!-- Residual connection 2 -->
    <path d="M 130 285 Q 80 330 130 330" fill="none" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="60" y="330" font-family="Arial" font-size="11" fill="#ff9800">+</text>

    <!-- Arrow out of decoder -->
    <line x1="200" y1="345" x2="200" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="210" y="365" font-family="Arial" font-size="10" fill="#666" font-style="italic">↻ repeat</text>

    <!-- Arrow -->
    <line x1="200" y1="420" x2="200" y2="450" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Output Layer -->
    <rect x="150" y="450" width="100" height="40" fill="#fce4ec" stroke="#c2185b" stroke-width="2" rx="5"/>
    <text x="200" y="470" text-anchor="middle" font-family="Arial" font-size="13" fill="#333">Output Layer</text>
    <text x="200" y="485" text-anchor="middle" font-family="Arial" font-size="9" fill="#666">(weight tied)</text>

    <!-- Arrow -->
    <line x1="200" y1="490" x2="200" y2="520" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Logits -->
    <rect x="150" y="520" width="100" height="40" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="200" y="545" text-anchor="middle" font-family="Arial" font-size="14" fill="#333">Logits</text>
</svg>
